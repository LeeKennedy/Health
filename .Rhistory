points <- 20   # How many points used to set control lines
# ---------------------------------------------------------------------------------
testname <- substr(data.raw$ANALYSIS[1],1,6)
Name <- data.raw$REPORTED_NAME[1]
Units <- tolower(sub("_P_","/",(data.raw$REPORTED_UNITS[1])))
# Clean the data
data.in <- select(data.raw, everything())%>%
arrange(SAMPLE_NUMBER)%>%
select(ASSIGNED_OPERATOR, SAMPLING_POINT, ENTRY)%>%
mutate(ENTRY = as.numeric(as.character(ENTRY)))%>%
na.omit
boxplot(data.in$ENTRY~data.in$SAMPLING_POINT,
main = paste("Comparative ",testname," SRM/IRM Results"),
ylab = paste(Name," ", Units))
j <- length(unique(data.in$SAMPLING_POINT))
remove.outliers <- function(x, na.rm = TRUE, ...) {
qnt <- quantile(x, probs=c(.25, .75), na.rm = na.rm, ...)
H <- 1.5 * IQR(x, na.rm = na.rm)
y <- x
y[x < (qnt[1] - H)] <- NA
y[x > (qnt[2] + H)] <- NA
y
}
srm1 <- unique(data.in[2])
srm <- srm1[j,]
data.in3 <- data.in[data.in$SAMPLING_POINT==srm,]
names(data.in3) <- c("Operator", "SRM","A")
data.in3 <- select(data.in3, everything())%>%
filter( between(row_number(), n()-max.pts, n()))
clean <- remove.outliers(data.in3$A[1:points])
xx <- describe(clean)
UCL <- xx$mean + 3*xx$sd
UWL <- xx$mean + 2*xx$sd
Centre <- xx$mean
LWL <- xx$mean - 2*xx$sd
LCL <- xx$mean - 3*xx$sd
MU <- 2*xx$sd
CC <- c(UCL, UWL, Centre, LWL, LCL ,MU)
Labels <- c("UCL", "UWL", "Centre", "LWL", "LCL", "MU +/-")
Clines <- cbind(Labels, round(CC,3))
Clines <- as.data.frame(Clines)
# Calculate outliers -----------------------------------------------------------
data.in3$outliers = NA
j <- nrow(data.in3)
for (i in 1:j) {
if(between(data.in3$A[i], LCL, UCL)==TRUE)
data.in3$outliers[i]=data.in3$A[i]
}
# Calculate trend on one side of mean ------------------------------------------
data.in3$T1 <- 1
data.in3$T2 <- 1
for (i in 2:j) {
if(data.in3$A[i] < Centre)
data.in3$T1[i] = -1
}
n=1
for (i in 2:j) {
if(data.in3$T1[i] == data.in3$T1[i - 1]) {
data.in3$T2[i] = n +1
n = n + 1
} else {
data.in3$T2[i] = 1
n = 1
}
}
data.in3$T3 <- NA
for (i in 1:j) {
if(data.in3$T2[i] > 6)
data.in3$T3[i] = data.in3$A[i]
}
# Trending up or down -----------------------------------------------------
data.in3$T4 <- 1
data.in3$T5 <- 1
for (i in 2:j) {
if(data.in3$A[i] < data.in3$A[i-1])
data.in3$T4[i] = -1
}
n=1
for (i in 2:j) {
if(data.in3$T4[i] == data.in3$T4[i - 1]) {
data.in3$T5[i] = n +1
n = n + 1
} else {
data.in3$T5[i] = 1
n = 1
}
}
data.in3$T6 <- NA
for (i in 1:j) {
if(data.in3$T5[i] > 6)
data.in3$T6[i] = data.in3$A[i]
}
# Plotting ----------------------------------------------------------------
plot(data.in3$A,
type="p",
pch= 19,
cex=1.0,
col ="red",
ylim = c(LCL*0.9,UCL*1.1),
ylab = paste(Name," ", Units),
xlab="")
par(new=T)
plot(data.in3$outliers,
type="o",
pch=19,
cex=1.0,
col="grey40",
ylim = c(LCL*0.9,UCL*1.1),
ylab = paste(Name," ", Units),
main = paste(srm, "(", Name,") Control Chart"),
xlab="")
par(new=T)
plot(data.in3$T3,
type="p",
pch= 19,
cex=1.0,
col ="limegreen",
ylim = c(LCL*0.9,UCL*1.1),
ylab = paste(Name," ", Units),
xlab="")
par(new=T)
plot(data.in3$T6,
type="p",
pch= 19,
cex=1.0,
col ="orange",
ylim = c(LCL*0.9,UCL*1.1),
ylab = paste(Name," ", Units),
xlab="")
abline(h=Centre, col = "blue", lty=2, lwd=2)
abline(h=UCL, col = "red", lty=2, lwd=2)
abline(h=UWL, col = "darkgreen", lty=3, lwd=2)
abline(h=LWL, col = "darkgreen", lty=3, lwd=2)
abline(h=LCL, col = "red", lty=2, lwd=2)
hist(data.in3$outliers,
breaks=20,
xlab=srm,
main = paste("Control Chart",srm,"data distribution"))
abline(v = Centre, col = "red", lty = 2)
print(describe(data.in3$outliers))
print (Clines)
xx <- boxplot(data.in3$A~data.in3$Operator, las=2, cex.axis = 0.8)
mytable <- xx$stats
colnames(mytable)<-xx$names
rownames(mytable)<-c('min','lower quartile','median','upper quartile','max')
mytable
table(data.in3$Operator)
# Rename incoming data file:
data.raw <- read.csv("SRM_data.csv", as.is=TRUE, header=TRUE)
colnames(data.raw)[1] <- "SAMPLE_NUMBER"
library(dplyr)
library(psych)
library(ggplot2)
# Input parameters ----------------------------------------------------------------
max.pts <- 90 # Maximum points plotted
points <- 20   # How many points used to set control lines
# ---------------------------------------------------------------------------------
testname <- substr(data.raw$ANALYSIS[1],1,6)
Name <- data.raw$REPORTED_NAME[1]
Units <- tolower(sub("_P_","/",(data.raw$REPORTED_UNITS[1])))
# Clean the data
data.in <- select(data.raw, everything())%>%
arrange(SAMPLE_NUMBER)%>%
select(ASSIGNED_OPERATOR, SAMPLING_POINT, ENTRY)%>%
mutate(ENTRY = as.numeric(as.character(ENTRY)))%>%
na.omit
boxplot(data.in$ENTRY~data.in$SAMPLING_POINT,
main = paste("Comparative ",testname," SRM/IRM Results"),
ylab = paste(Name," ", Units))
j <- length(unique(data.in$SAMPLING_POINT))
remove.outliers <- function(x, na.rm = TRUE, ...) {
qnt <- quantile(x, probs=c(.25, .75), na.rm = na.rm, ...)
H <- 1.5 * IQR(x, na.rm = na.rm)
y <- x
y[x < (qnt[1] - H)] <- NA
y[x > (qnt[2] + H)] <- NA
y
}
srm1 <- unique(data.in[2])
srm <- srm1[j,]
data.in3 <- data.in[data.in$SAMPLING_POINT==srm,]
names(data.in3) <- c("Operator", "SRM","A")
data.in3 <- select(data.in3, everything())%>%
filter( between(row_number(), n()-max.pts, n()))
clean <- remove.outliers(data.in3$A[1:points])
xx <- describe(clean)
UCL <- xx$mean + 3*xx$sd
UWL <- xx$mean + 2*xx$sd
Centre <- xx$mean
LWL <- xx$mean - 2*xx$sd
LCL <- xx$mean - 3*xx$sd
MU <- 2*xx$sd
CC <- c(UCL, UWL, Centre, LWL, LCL ,MU)
Labels <- c("UCL", "UWL", "Centre", "LWL", "LCL", "MU +/-")
Clines <- cbind(Labels, round(CC,3))
Clines <- as.data.frame(Clines)
# Calculate outliers -----------------------------------------------------------
data.in3$outliers = NA
j <- nrow(data.in3)
for (i in 1:j) {
if(between(data.in3$A[i], LCL, UCL)==TRUE)
data.in3$outliers[i]=data.in3$A[i]
}
# Calculate trend on one side of mean ------------------------------------------
data.in3$T1 <- 1
data.in3$T2 <- 1
for (i in 2:j) {
if(data.in3$A[i] < Centre)
data.in3$T1[i] = -1
}
n=1
for (i in 2:j) {
if(data.in3$T1[i] == data.in3$T1[i - 1]) {
data.in3$T2[i] = n +1
n = n + 1
} else {
data.in3$T2[i] = 1
n = 1
}
}
data.in3$T3 <- NA
for (i in 1:j) {
if(data.in3$T2[i] > 6)
data.in3$T3[i] = data.in3$A[i]
}
# Trending up or down -----------------------------------------------------
data.in3$T4 <- 1
data.in3$T5 <- 1
for (i in 2:j) {
if(data.in3$A[i] < data.in3$A[i-1])
data.in3$T4[i] = -1
}
n=1
for (i in 2:j) {
if(data.in3$T4[i] == data.in3$T4[i - 1]) {
data.in3$T5[i] = n +1
n = n + 1
} else {
data.in3$T5[i] = 1
n = 1
}
}
data.in3$T6 <- NA
for (i in 1:j) {
if(data.in3$T5[i] > 6)
data.in3$T6[i] = data.in3$A[i]
}
# Plotting ----------------------------------------------------------------
plot(data.in3$A,
type="p",
pch= 19,
cex=1.0,
col ="red",
ylim = c(LCL*0.9,UCL*1.1),
ylab = paste(Name," ", Units),
xlab="")
par(new=T)
plot(data.in3$outliers,
type="o",
pch=19,
cex=1.0,
col="grey40",
ylim = c(LCL*0.9,UCL*1.1),
ylab = paste(Name," ", Units),
main = paste(srm, "(", Name,") Control Chart"),
xlab="")
par(new=T)
plot(data.in3$T3,
type="p",
pch= 19,
cex=1.0,
col ="limegreen",
ylim = c(LCL*0.9,UCL*1.1),
ylab = paste(Name," ", Units),
xlab="")
par(new=T)
plot(data.in3$T6,
type="p",
pch= 19,
cex=1.0,
col ="orange",
ylim = c(LCL*0.9,UCL*1.1),
ylab = paste(Name," ", Units),
xlab="")
abline(h=Centre, col = "blue", lty=2, lwd=2)
abline(h=UCL, col = "red", lty=2, lwd=2)
abline(h=UWL, col = "darkgreen", lty=3, lwd=2)
abline(h=LWL, col = "darkgreen", lty=3, lwd=2)
abline(h=LCL, col = "red", lty=2, lwd=2)
hist(data.in3$outliers,
breaks=20,
xlab=srm,
main = paste("Control Chart",srm,"data distribution"))
abline(v = Centre, col = "red", lty = 2)
print(describe(data.in3$outliers))
print (Clines)
xx <- boxplot(data.in3$A~data.in3$Operator, las=2, cex.axis = 0.8)
mytable <- xx$stats
colnames(mytable)<-xx$names
rownames(mytable)<-c('min','lower quartile','median','upper quartile','max')
mytable
table(data.in3$Operator)
xx <- boxplot(data.in3$A~data.in3$Operator, las=2, cex.axis = 0.8)
abline(h=Centre, col = "blue", lty=2, lwd=2)
setwd("~/Documents/GitHub/Health")
weight <- read.csv("Healthcheck.csv", header = TRUE)
weight1 <- weight[,c(1,7)]
weight1 <- weight[,c(2,8)]
weight1 <- na.omit(weight1)
weight2 <- weight1[1400:nrow(weight1),]
weight3 <- weight[,c(5,8)]
weight3 <- na.omit(weight3)
weight4 <-weight[,c(2,8:10)]
height <- 1.89
BMI <- (weight4$Weight)/(height^2)
w2h <- weight4$Waist/weight4$Hips
weight5 <- cbind(weight4, BMI,w2h)
library(ggplot2)
#Weight over recent time
ggplot(weight2, aes(Index,Weight)) +
geom_point(colour = "blue", size = 3) +
geom_smooth(colour = "darkgreen") +
ggtitle("Weight") +
ylim(85,95)
weight <- read.csv("Healthcheck.csv", header = TRUE)
weight1 <- weight[,c(1,8)]
weight1 <- na.omit(weight1)
weight2 <- weight1[1400:nrow(weight1),]
weight3 <- weight[,c(5,8)]
weight3 <- na.omit(weight3)
weight4 <-weight[,c(1,8:10)]
height <- 1.89
BMI <- (weight4$Weight)/(height^2)
w2h <- weight4$Waist/weight4$Hips
weight5 <- cbind(weight4, BMI,w2h)
library(ggplot2)
#Weight over recent time
ggplot(weight2, aes(Index,Weight)) +
geom_point(colour = "blue", size = 3) +
geom_smooth(colour = "darkgreen") +
ggtitle("Weight") +
ylim(85,95)
#Weight over longer time
ggplot(weight1, aes(Index,Weight)) +
geom_point(colour = "blue", size = 2) +
geom_smooth(colour = "darkgreen") +
ggtitle("Weight") +
ylim(85,105)
boxplot(Weight ~ Year, data = weight3)
weight3 <- weight[,c(4,8)]
boxplot(Weight ~ Year, data = weight3)
ggplot(weight5[2400:nrow(weight5),], aes(x = Index, y = w2h)) +
geom_point() +
geom_smooth(colour = "darkgreen") +
ggtitle("Waist to Hip Ratio")
#BMI
ggplot(weight5[2400:nrow(weight5),], aes(x = Index, y = BMI)) +
geom_point() +
geom_smooth(colour = "blue") +
ggtitle("BMI")
ggplot(weight5[2400:nrow(weight5),], aes(x = Index, y = w2h)) +
geom_point() +
geom_smooth(colour = "darkgreen") +
ggtitle("Waist to Hip Ratio")
max(weight5$w2h)
weight5$w2h
weight <- read.csv("Healthcheck.csv", header = TRUE)
weight1 <- weight[,c(1,8)]
weight1 <- na.omit(weight1)
weight2 <- weight1[1400:nrow(weight1),]
weight3 <- weight[,c(4,8)]
weight3 <- na.omit(weight3)
weight4 <-weight[,c(1,8:10)]
height <- 1.89
BMI <- (weight4$Weight)/(height^2)
w2h <- weight4$Waist/weight4$Hips
weight5 <- cbind(weight4, BMI,w2h)
library(ggplot2)
#Weight over recent time
ggplot(weight2, aes(Index,Weight)) +
geom_point(colour = "blue", size = 3) +
geom_smooth(colour = "darkgreen") +
ggtitle("Weight") +
ylim(85,95)
#Weight over longer time
ggplot(weight1, aes(Index,Weight)) +
geom_point(colour = "blue", size = 2) +
geom_smooth(colour = "darkgreen") +
ggtitle("Weight") +
ylim(85,105)
boxplot(Weight ~ Year, data = weight3)
#Waist to Hip Ratio
ggplot(weight5[2400:nrow(weight5),], aes(x = Index, y = w2h)) +
geom_point() +
geom_smooth(colour = "darkgreen") +
ggtitle("Waist to Hip Ratio")
#BMI
ggplot(weight5[2400:nrow(weight5),], aes(x = Index, y = BMI)) +
geom_point() +
geom_smooth(colour = "blue") +
ggtitle("BMI")
boxplot(Weight ~ Year,
data = weight3,
colour = "cornflower")
boxplot(Weight ~ Year,
data = weight3,
col = "cornflower")
boxplot(Weight ~ Year,
data = weight3,
col = "cornflowerblue")
colors = c(rep("red",9),rep("blue",1))
boxplot(Weight ~ Year,
data = weight3,
col = colors)
colors = c(rep("cornflowerblue",9),rep("beige",1))
boxplot(Weight ~ Year,
data = weight3,
col = colors)
colors = c(rep("cornflowerblue",9),rep("limegreen",1))
boxplot(Weight ~ Year,
data = weight3,
col = colors)
weight <- read.csv("Healthcheck.csv", header = TRUE)
weight1 <- weight[,c(1,8)]
weight1 <- na.omit(weight1)
weight2 <- weight1[1400:nrow(weight1),]
weight3 <- weight[,c(4,8)]
weight3 <- na.omit(weight3)
weight4 <-weight[,c(1,8:10)]
height <- 1.89
BMI <- (weight4$Weight)/(height^2)
w2h <- weight4$Waist/weight4$Hips
weight5 <- cbind(weight4, BMI,w2h)
library(ggplot2)
#Weight over recent time
ggplot(weight2, aes(Index,Weight)) +
geom_point(colour = "blue", size = 3) +
geom_smooth(colour = "darkgreen") +
ggtitle("Weight") +
ylim(85,95)
#Weight over longer time
ggplot(weight1, aes(Index,Weight)) +
geom_point(colour = "blue", size = 2) +
geom_smooth(colour = "darkgreen") +
ggtitle("Weight") +
ylim(85,105)
colors = c(rep("cornflowerblue",9),rep("limegreen",1))
boxplot(Weight ~ Year,
data = weight3,
col = colors)
#Waist to Hip Ratio
ggplot(weight5[2400:nrow(weight5),], aes(x = Index, y = w2h)) +
geom_point() +
geom_smooth(colour = "darkgreen") +
ggtitle("Waist to Hip Ratio")
#BMI
ggplot(weight5[2400:nrow(weight5),], aes(x = Index, y = BMI)) +
geom_point() +
geom_smooth(colour = "blue") +
ggtitle("BMI")
weight <- read.csv("Healthcheck.csv", header = TRUE)
weight1 <- weight[,c(1,8)]
weight1 <- na.omit(weight1)
weight2 <- weight1[1400:nrow(weight1),]
weight3 <- weight[,c(4,8)]
weight3 <- na.omit(weight3)
weight4 <-weight[,c(1,8:10)]
height <- 1.89
BMI <- (weight4$Weight)/(height^2)
w2h <- weight4$Waist/weight4$Hips
weight5 <- cbind(weight4, BMI,w2h)
library(ggplot2)
#Weight over recent time
ggplot(weight2, aes(Index,Weight)) +
geom_point(colour = "blue", size = 3) +
geom_smooth(colour = "darkgreen") +
ggtitle("Weight") +
ylim(85,95)
#Weight over recent time
ggplot(weight2, aes(Index,Weight)) +
geom_point(colour = "blue", size = 3) +
geom_smooth(method=loess, colour = "darkgreen") +
ggtitle("Weight") +
ylim(85,95)
#Weight over longer time
ggplot(weight1, aes(Index,Weight)) +
geom_point(colour = "blue", size = 2) +
geom_smooth(colour = "darkgreen") +
ggtitle("Weight") +
ylim(85,105)
#Weight over longer time
ggplot(weight1, aes(Index,Weight)) +
geom_point(colour = "blue", size = 2) +
geom_smooth(method = loess, colour = "darkgreen") +
ggtitle("Weight") +
ylim(85,105)
#Weight over longer time
ggplot(weight1, aes(Index,Weight)) +
geom_point(colour = "blue", size = 2) +
geom_smooth(colour = "darkgreen") +
ggtitle("Weight") +
ylim(85,105)
#Waist to Hip Ratio
ggplot(weight5[2400:nrow(weight5),], aes(x = Index, y = w2h)) +
geom_point() +
geom_smooth(colour = "darkgreen") +
ggtitle("Waist to Hip Ratio")
#BMI
ggplot(weight5[2400:nrow(weight5),], aes(x = Index, y = BMI)) +
geom_point() +
geom_smooth(colour = "blue") +
ggtitle("BMI")
